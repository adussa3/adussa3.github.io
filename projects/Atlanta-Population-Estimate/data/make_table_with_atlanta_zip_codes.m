% input is an array of file names

% file_array can be
% 1) a string of the file name (e.g, "file_name")
% 2) an array of strings of file names (e.g., ["file_name1", "file_name2", ...])

% make sure this program is in the same directory of the files you want to change

function make_table_with_atlanta_zip_codes(file_array)
    %% Atlanta zip codes
    atl_zip_codes = [30030, 30032, 30126, 30303, 30305, 30306, 30307,...
                     30308, 30309, 30310, 30311, 30312, 30313, 30314,...
                     30315, 30316, 30317, 30318, 30319, 30324, 30326,...
                     30327, 30331, 30332, 30334, 30336, 30342, 30344,...
                     30354, 30363];
    
%     atl_zip_codes = [30301, 30302, 30303, 30304, 30307, 30308, 30311,...
%                      30312, 30316, 30317, 30305, 30306, 30309, 30310,...
%                      30313, 30314, 30315, 30318, 30319, 30322, 30324,...
%                      30327, 30328, 30330, 30331, 30334, 30336, 30320,...
%                      30321, 30325, 30326, 30329, 30332, 30333, 30337,...
%                      30339, 30341, 30342, 30344, 30345, 30338, 30340,...
%                      30343, 30346, 30348, 30353, 30354, 30357, 30360,...
%                      30361, 30362, 30349, 30350, 30355, 30356, 30358,...
%                      30359, 30363, 30364, 30369, 30370, 30375, 30377,...
%                      30384, 30385, 30394, 30396, 30366, 30368, 30371,...
%                      30374, 30378, 30380, 30388, 30392, 30398, 31106,...
%                      31107, 31131, 31136, 31119, 31126, 31139, 31141,...
%                      31146, 31192, 31196, 31145, 31150, 31156, 31193,...
%                      31195, 39901]
    
    %% make a new table that only contains Atlanta zip codes
    for file = file_array
        % read table
        data = readtable(file);
        
        % get table's zip code array
        georgia_zip_codes = str2double(data.GEO_id2);
        
        % make new table
        new_data = data(1,:);
        
        % filter out non-Atlanta zip codes
        for atl_zip_code = atl_zip_codes
            row_index = atl_zip_code == georgia_zip_codes;
            new_data = [new_data;data(row_index,:)];
        end
        
        % write a new file
        [name, type] = strtok(file, ".");
        new_file = name + "_new" + type;

        writetable(new_data, new_file);
    end
end